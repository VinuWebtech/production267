<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2014 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<?php
$_product    = $this->getProduct();
$_attributes = Mage::helper('core')->decorateArray($this->getAllowAttributes());
$_jsonConfig = $this->getJsonConfig();
$_renderers = $this->getChild('attr_renderers')->getSortedChildren();
?>
<!--changes start added-->
<table class="data-table configurable-items-table" id="insideconfigurable-product-table">
    <thead>
        <tr>
            <th><?php echo $this->__('Product Name') ?></th>
            <?php
            $attrs  = $_product->getTypeInstance(true)->getConfigurableAttributesAsArray($_product);
            foreach($attrs as $attr) 
            {
                $options = $attr['values']; 
            ?>
            <th><?php echo $this->escapeHtml($this->__($attr['label'])) ?></th>         
            <?php        
                }
            ?>
            <?php if ($this->getCanShowProductPrice($_product)): ?>
            <th><?php echo $this->__('Price') ?></th>
            <?php endif; ?>
            <?php if ($_product->isSaleable()): ?>
            <th><?php echo $this->__('Qty') ?></th>
            <?php endif; ?>
        </tr>
    </thead>
    <tbody>
        <?php 
        if($_product->getTypeId() == "configurable"):
            $conf = Mage::getModel('catalog/product_type_configurable')->setProduct($_product);
            $simple_collection = $conf->getUsedProductCollection()->addAttributeToSelect('*')->addFilterByRequiredOptions();
            foreach($simple_collection as $simple_product){ 
        ?> 
        <tr>  
            <td> 
                <?php echo $simple_product->getName(); ?>
            </td>
            <?php
            $attrs  = $_product->getTypeInstance(true)->getConfigurableAttributesAsArray($_product);
            foreach($attrs as $attr) 
            {
                $options    = $attr['values']; 
            ?>
            <td>
                <?php echo $simple_product->getAttributeText($attr['attribute_code']); ?>
            </td>               
            <?php        
                }
            ?> 
            <td> 
                <?php  echo Mage::helper('core')->currency($simple_product->getPrice()); ?>
            </td> 
            <td>
                <?php if ($simple_product->isSaleable()) : ?>
                    <div class="qty-value">
                        <input type="text" name="super_group[<?php echo $simple_product->getId() ?>]" maxlength="12" value="1" "<?php echo $simple_product->getQty()*1 ?>" title="<?php echo $this->__('Qty') ?>" class="input-text qty" />
                        <div class="qty-updown">
                            <a href="javascript:void(0)" class="qty_inc"><i class="icon-up-dir"></i></a>
                            <a href="javascript:void(0)" class="qty_dec"><i class="icon-down-dir"></i></a>
                        </div>
                        <button type="button"  onclick="setLocation('<?php echo $this->getAddToCartUrl($simple_product) ?>' + 'qty/' + $(this).previous().previous().value)" class="config-button"><span>Add to Cart</span></button>
                    </div>
                <?php else: ?>
                    <p class="availability out-of-stock"><span><?php echo $this->__('Out of stock') ?></span></p>
                <?php endif; ?>
            </td>
        </tr> 
        <?php  }
            endif;
        ?>
    </tbody>
</table>       
<script type="text/javascript">
    var spConfig = new Product.Config(<?php echo $_jsonConfig ?>);
</script>
<?php echo $this->getChildHtml('after') ?>
<!--changes end-->